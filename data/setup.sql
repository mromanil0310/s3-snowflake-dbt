-- Warehouse
CREATE WAREHOUSE IF NOT EXISTS COMPUTE_WH
  WITH
    WAREHOUSE_SIZE = 'XSMALL'
    AUTO_SUSPEND = 60
    AUTO_RESUME = TRUE
    INITIALLY_SUSPENDED = TRUE;

-- Database
CREATE DATABASE IF NOT EXISTS DBT_ELT;

-- Schemas
CREATE SCHEMA IF NOT EXISTS DBT_ELT.STAGING;
CREATE SCHEMA IF NOT EXISTS DBT_ELT.BASE;

-- Raw table
CREATE OR REPLACE TABLE DBT_ELT.STAGING.ORDERS (
    ORDER_ID VARCHAR,
    CUSTOMER_ID VARCHAR,
    ORDER_DATE VARCHAR,
    STATUS VARCHAR,
    PRODUCT_ID VARCHAR,
    QUANTITY VARCHAR,
    PRICE VARCHAR,
    TOTAL_AMOUNT VARCHAR,
    CDC_TIMESTAMP VARCHAR
);

-- Stage specific to CUSTOMERS
CREATE OR REPLACE STAGE DBT_ELT.STAGING.MY_INTERNAL_STAGE;

-- Optional: test COPY script (similar to what Airflow will run)
-- (Assuming file exists at the Airflow path inside the container)
-- PUT and COPY will be executed by Airflow, not manually, but shown here for reference:

-- PUT file:///opt/airflow/data/source/customers.csv @MINIO_ELT_DB.RAW.CUSTOMERS_STAGE
--   AUTO_COMPRESS = TRUE
--   OVERWRITE = TRUE;

-- COPY INTO MINIO_ELT_DB.RAW.CUSTOMERS
-- FROM @MINIO_ELT_DB.RAW.CUSTOMERS_STAGE
-- FILE_FORMAT = (TYPE = CSV SKIP_HEADER = 1 FIELD_OPTIONALLY_ENCLOSED_BY='"' FIELD_DELIMITER=',')
-- ON_ERROR = 'ABORT_STATEMENT';
